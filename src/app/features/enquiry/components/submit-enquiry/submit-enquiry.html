<div class="submit-wrapper">
  <div class="submit-card">

    <div class="card-header">
      <h2>Submit Enquiry</h2>
      <a routerLink="/member" class="back-link">
        Go to Dashboard
      </a>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()">

      <div class="form-group">
        <label>Title</label>
        <input type="text" formControlName="title" placeholder="Enter enquiry title"
          [class.invalid]="f.title.touched && f.title.invalid" />

        @if (f.title.touched && f.title.invalid) {
        <small class="error">
          @if (f.title.errors?.['required']) {
          Title is required
          }
          @if (f.title.errors?.['minlength']) {
          Minimum 3 characters required
          }
        </small>
        }
      </div>

      <div class="form-group">
        <label>Message</label>
        <textarea formControlName="message" placeholder="Write your message..." rows="4"
          [class.invalid]="f.message.touched && f.message.invalid"></textarea>

        @if (f.message.touched && f.message.invalid) {
        <small class="error">
          Message must be at least 10 characters
        </small>
        }
      </div>

      <div class="form-group">
        <label>Your Name</label>
        <input type="text" formControlName="customerName" placeholder="Enter your name"
          [class.invalid]="f.customerName.touched && f.customerName.invalid" />

        @if (f.customerName.touched && f.customerName.invalid) {
        <small class="error">Name is required</small>
        }
      </div>

      <div class="form-group">
        <label>Email</label>
        <input type="email" formControlName="customerEmail" placeholder="Enter your email"
          [class.invalid]="f.customerEmail.touched && f.customerEmail.invalid" />

        @if (f.customerEmail.touched && f.customerEmail.invalid) {
        <small class="error">
          @if (f.customerEmail.errors?.['required']) {
          Email is required
          }
          @if (f.customerEmail.errors?.['email']) {
          Enter a valid email address
          }
        </small>
        }
      </div>

      <div class="form-group">
        <label>Phone (Optional)</label>
        <input type="text" formControlName="customerPhone" placeholder="Enter phone number" />
      </div>

      <div class="form-group">
        <label>Follow Up Date</label>
        <input type="date" formControlName="followUpDate" />
      </div>

      <div class="form-group">
        <label>Category</label>
        <select formControlName="categoryId" [class.invalid]="f.categoryId.touched && f.categoryId.invalid">
          <option [value]="0">Select Category</option>

          @for (cat of categoryService.categories(); track cat.id) {
          <option [value]="cat.id">
            {{ cat.name }}
          </option>
          }
        </select>

        @if (f.categoryId.touched && f.categoryId.invalid) {
        <small class="error">Please select a category</small>
        }
      </div>

      <button type="submit" [disabled]="form.invalid || loading()">
        @if (loading()) {
        Submitting...
        } @else {
        Submit Enquiry
        }
      </button>

      @if (submitted()) {
      <p class="success-message">
        Enquiry submitted successfully!
      </p>
      }

    </form>
  </div>
</div>