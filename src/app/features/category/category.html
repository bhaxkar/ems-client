<div class="category-container">

  <div class="admin-header d-flex justify-content-between align-items-center">
    <h2>Category Management</h2>

    <button class="btn btn-primary" (click)="openCreateModal()">
      + Create Category
    </button>
  </div>


  <hr />

  @if (categoryService.loading()) {
  <p class="loading">Loading...</p>
  }

  <div class="card-grid">
    @for (cat of categoryService.categories(); track cat.id) {

    <div class="category-card">

      <div class="card-header">
        <span class="id fw-semibold text-dark">
          {{ cat.id }}
        </span>

        <span class="badge px-3 py-2 rounded-pill" [ngClass]="cat.isActive ? 'badge-active' : 'badge-inactive'">
          {{ cat.isActive ? 'Active' : 'Inactive' }}
        </span>
      </div>

      <h4>{{ cat.name }}</h4>

      <p class="description">
        {{ cat.description || 'No description provided.' }}
      </p>

      <small class="date">
        Created: {{ cat.createdAt | date }}
      </small>

      <div class="card-actions mt-2">
        <button class="btn btn-sm btn-warning me-2" (click)="openEditModal(cat)">
          Edit
        </button>

        <button class="btn btn-sm btn-danger" (click)="remove(cat.id)">
          Delete
        </button>
      </div>

    </div>
    }
  </div>
</div>

<div #categoryModal class="modal fade" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          {{ editMode() ? 'Update Category' : 'Create Category' }}
        </h5>

        <button type="button" class="btn-close btn-close-white" (click)="closeModal()">
        </button>
      </div>

      <div class="modal-body">

        <form [formGroup]="form" (ngSubmit)="submit()">

          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" class="form-control" formControlName="name"
              [class.is-invalid]="form.controls.name.invalid && form.controls.name.touched">

            @if (form.controls.name.touched && form.controls.name.invalid) {
            <div class="invalid-feedback">

              @if (form.controls.name.errors?.['required']) {
              Name is required.
              }

              @if (form.controls.name.errors?.['minlength']) {
              Name must be at least
              {{ form.controls.name.errors?.['minlength'].requiredLength }}
              characters long.
              }

            </div>
            }
          </div>

          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" rows="3" formControlName="description">
            </textarea>
          </div>

          <div class="form-check mb-3">
            <input type="checkbox" class="form-check-input" formControlName="isActive">
            <label class="form-check-label">
              Active
            </label>
          </div>

          <div class="text-end">
            <button type="button" class="btn btn-secondary me-2" (click)="closeModal()">
              Cancel
            </button>

            <button type="submit" class="btn btn-primary" [disabled]="form.invalid">
              {{ editMode() ? 'Update' : 'Create' }}
            </button>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>